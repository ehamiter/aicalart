<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>aical.art</title>
  <meta name="description" content="News headlines, calendar events, holidays, random styles, and the ever-present orange tabby Hobbes turn into art via GPT + DALL-E.">
  <meta name="keywords" content="web, software, ai, Python, DALL-E, ChatGPT, art, calendar, cat, Hobbes, GPT-4, GPT-4-turbo, gpt-4-1106-preview, dall-e-3">
  <meta name="author" content="Chimera Tier">
  <link rel="apple-touch-icon" sizes="180x180" href="./static/images/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="./static/images/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./static/images/icons/favicon-16x16.png">
  <link rel="shortcut icon" href="./static/images/icons/favicon.ico">
  <link rel="manifest" href="./static/site.webmanifest">
  <link rel="stylesheet" href="./static/css/style.css"/>
  <link rel="preconnect" href="https://www.w3counter.com">

  <script>
    let currentDate = new Date();

    function formatDate(date) {
      return date.toISOString().split('T')[0];
    }

    let pageJustLoaded = true; // Flag to track initial load

    function updateImageTitleAndBackground() {
      let dateString = formatDate(currentDate);
      let orientation = window.matchMedia("(orientation: portrait)").matches ? 'portrait' : 'landscape';
      let basePromptUrl = `https://aicalart.s3.amazonaws.com/prompts/`;
      let baseImageUrl = `https://aicalart.s3.amazonaws.com/images/`;
      let textFile, bgFile;

      if (pageJustLoaded) {
        // For initial load, use undated files
        textFile = `${basePromptUrl}${orientation}.txt`;
        bgFile = `url('${baseImageUrl}${orientation}.webp')`;
        pageJustLoaded = false; // Set to false after initial load
      } else {
        // For subsequent loads, use dated files
        textFile = `${basePromptUrl}${dateString}-${orientation}.txt`;
        bgFile = `url('${baseImageUrl}${dateString}-${orientation}.webp')`;
      }

      fetch(textFile)
      .then(response => response.text())
      .then(text => {
        document.querySelector('.bg-image').setAttribute('title', text);
        document.querySelector('.bg-image').style.backgroundImage = bgFile;
      })
      .catch(error => {
        console.error('Fetch failed: ', error);
      });
    }

    function changeDate(days) {
      let newDate = new Date(currentDate.valueOf()); // Create a new date based on currentDate
      newDate.setDate(newDate.getDate() + days);

      let today = new Date();
      today.setHours(0, 0, 0, 0); // Reset hours to start of the day for comparison

      // Check if newDate is in the future compared to today
      if (newDate > today) {
        console.log('Cannot navigate to a future date');
        return; // Stop the function if the new date is in the future
      }

      // Check if newDate is before the minimum allowed date
      let minDate = new Date('2023-11-25');
      if (newDate < minDate) {
        console.log('Cannot navigate before November 25, 2023');
        return; // Stop the function if the new date is before the minimum date
      }

      currentDate = newDate; // Update currentDate if it's a valid date
      updateImageTitleAndBackground();
    }

    let touchstartX = 0;
    let touchendX = 0;

    function handleGesture() {
      if (touchendX < touchstartX) changeDate(1);
      if (touchendX > touchstartX) changeDate(-1);
    }

    document.addEventListener('touchstart', e => {
      touchstartX = e.changedTouches[0].screenX;
    });

    document.addEventListener('touchend', e => {
      touchendX = e.changedTouches[0].screenX;
      handleGesture();
    });

    document.addEventListener('keydown', function(event) {
      if (event.key === 'ArrowLeft') {
        changeDate(-1);
      } else if (event.key === 'ArrowRight') {
        changeDate(1);
      }
    });

    window.addEventListener("resize", updateImageTitleAndBackground);

    window.onload = updateImageTitleAndBackground;
  </script>

  </head>
  <body onload="updateImageTitleAndBackground()">
    <div class="bg-image"></div>
    <script src="https://www.w3counter.com/tracker.js?id=150909"></script>
  </body>
</html>